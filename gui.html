<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Stream & Controls</title>
</head>
<body>
    <table width="1920" height="1080" style="border: 1px solid black;">
        <tr>
            <td width="960" style="border: 1px solid black;" >
                <iframe src='127.0.0.0:5000/proc_vid' id="myVideo1" width=640  height= 480">
            </td>

            <td height="540" style="border: 1px solid black;">	
                <table width="960" height="540">
                    <tr>
                        <td></td>
                        <td align="center" style="border: 1px solid black;" valign="middle">
                            <button type="button" style="font-size: 40px;" onclick="sendCommand('forward')">&uarr;</button>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td align="center" style="border: 1px solid black;" valign="middle">
                            <button type="button" style="font-size: 40px;" onclick="sendCommand('left')">&larr;</button>
                        </td>
                        <td align="center" style="border: 1px solid black;" width="320" valign="middle">
                            <button type="button" style="font-size: 45px;">&blacktriangleright;</button>
                            <button type="button" style="font-size: 40px;" onclick="sendCommand('stop')">&blacksquare;</button>
                        </td>
                        <td align="center" style="border: 1px solid black;" valign="middle">
                            <button type="button" style="font-size: 40px;" onclick="sendCommand('right')">&rarr;</button>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td align="center" style="border: 1px solid black;" valign="middle">
                            <button type="button" style="font-size: 40px;" onclick="sendCommand('backward')">&darr;</button>
                        </td>
                        <td></td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td style="border: 1px solid black;">
                <iframe src='192.168.240.123:5000/video' id="myVideo1" width=640  height= 480">
            </td>
            <td style="border: 1px solid black;"><div id='log'>log</div></td>
        </tr>
    </table>
</body>

<script>
    const API_URL = 'http://127.0.0.1:5000';
    async function addlog(data){const response = await fetch(API_URL+'/log', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 'logdata': data }),
            });    }
    async function sendCommand(direction) {
        const log = document.getElementById('log');
        console.log(`Attempting to send command: ${direction}`);
        log.innerHTML+=`<br>Attempting to send command: ${direction}`
        try {
            const response = await fetch(API_URL+'/controls', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ direction: direction }),
            });

            if (response.ok) {
                const result = await response.json();
                console.log('Command successful. Direction:', result.direction);
                log.innerHTML+=`<br>Command successful. Direction:${result.direction}`
            } else {
                const errorText = await response.text();
                console.error('Command failed. Status:', response.status, 'Error:', errorText);
            }
        } catch (error) {
            console.error('Network error during API call. Check if the Flask server is running:', error);
        }
    }
    
    // --- Video Stream Setup ---
    
    
    // The play() call is unnecessary for <img> tags
</script>
</html>
